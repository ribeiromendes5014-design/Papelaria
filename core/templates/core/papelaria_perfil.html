{% extends "base.html" %}

{% block title %}Meu Perfil da Papelaria{% endblock %}

{% block content %}
  <section class="papelaria-perfil">
    <header>
      <p class="config-overline">Papelaria</p>
      <h1>Meu Perfil</h1>
      <p>Essas informações aparecem para os clientes que entram no catálogo público.</p>
    </header>

    {% if tenant_selector_options|length > 1 %}
      <form method="get" class="tenant-selector">
        <label for="tenant-select">Selecione uma papelaria para editar</label>
        <select id="tenant-select" name="tenant" onchange="this.form.submit()">
          <option value="">Escolher papelaria</option>
            {% for option in tenant_selector_options %}
              {% with option.slug|default:option.pk as identifier %}
                {% with option.nome_negocio|default:option.user.get_full_name as alias_name %}
                  {% with alias_name|default:option.user.username as display_name %}
                    <option
                      value="{{ identifier }}"
                      {% if selected_tenant and selected_tenant.pk == option.pk %}selected{% endif %}
                    >
                      {% if display_name %}
                        {{ display_name }}
                      {% else %}
                        Tenant {{ option.pk }}
                      {% endif %}
                    </option>
                  {% endwith %}
                {% endwith %}
              {% endwith %}
            {% endfor %}
          </select>
      </form>
    {% endif %}
    {% if selected_tenant %}
      <form method="post" class="papelaria-form">
        {% if tenant_selector_options and selected_tenant %}
          <input type="hidden" name="tenant" value="{{ selected_tenant.slug|default:selected_tenant.pk }}">
        {% endif %}
        {% csrf_token %}
        {% if form.errors %}
          <div class="form-errors">
            {{ form.errors }}
          </div>
        {% endif %}
        <div class="papelaria-form-grid">
          <label>
            <span class="label">Nome do negócio</span>
            {{ form.nome_negocio }}
          </label>
          <label>
            <span class="label">WhatsApp</span>
            {{ form.whatsapp }}
          </label>
        </div>
        <p class="info-text">O slug público é gerado automaticamente a partir do nome do negócio.</p>
        <button type="submit" class="papelaria-primary-btn">Salvar perfil</button>
      </form>
    {% else %}
      <p class="empty-state">Selecione uma papelaria acima para editar.</p>
    {% endif %}
    <div class="papelaria-details">
      <article>
        <p class="label">Nome exibido</p>
        <h2>{{ tenant_name|default:"Ainda não definido" }}</h2>
      </article>
      <article>
        <p class="label">WhatsApp</p>
        <h2>{{ tenant_whatsapp|default:"(Sem WhatsApp)" }}</h2>
      </article>
      <article class="catalog-link">
        <p class="label">Link do catálogo</p>
        {% if catalog_url %}
          <a href="{{ catalog_url }}">{{ catalog_url }}</a>
        {% else %}
          <span class="empty">Aguardando slug público...</span>
        {% endif %}
      </article>
    </div>
  </section>

  <style>
    .papelaria-perfil {
      background: #fff;
      border-radius: 32px;
      padding: 2rem;
      box-shadow: 0 25px 60px rgba(15, 23, 42, 0.15);
      margin: 2rem 0;
    }

    .papelaria-perfil header h1 {
      margin: 0.25rem 0;
      font-size: 2.2rem;
    }

    .papelaria-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .papelaria-form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.85rem;
    }

    .papelaria-form-grid label {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-weight: 600;
      color: #0f172a;
    }

    .papelaria-form-grid input {
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, 0.18);
      padding: 0.75rem 0.9rem;
      font-size: 1rem;
      font-family: inherit;
    }

    .papelaria-details {
      margin-top: 1.75rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .papelaria-details article {
      background: #f8fafc;
      border-radius: 20px;
      padding: 1.25rem;
      border: 1px solid rgba(15, 23, 42, 0.08);
    }

    .papelaria-details .label {
      text-transform: uppercase;
      letter-spacing: 0.2em;
      font-size: 0.7rem;
      color: #94a3b8;
      margin-bottom: 0.35rem;
    }

    .papelaria-details h2 {
      margin: 0;
      font-size: 1.35rem;
      color: #0f172a;
    }

    .info-text {
      font-size: 0.85rem;
      color: #475569;
      margin-bottom: 1rem;
    }

    .catalog-link a {
      display: inline-block;
      margin-top: 0.45rem;
      color: #0f172a;
      text-decoration: underline;
      word-break: break-all;
    }

    .empty {
      color: #94a3b8;
      font-style: italic;
    }
    .empty-state {
      margin-top: 1rem;
      text-align: center;
      color: #94a3b8;
      font-style: italic;
    }
    .papelaria-primary-btn {
      background: linear-gradient(120deg, #06b6d4, #0ea5e9);
      color: #fff;
      border: none;
      border-radius: 16px;
      padding: 0.95rem 1.4rem;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      box-shadow: 0 12px 30px rgba(14, 165, 233, 0.35);
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .papelaria-primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 35px rgba(14, 165, 233, 0.45);
    }

    .form-errors {
      background: #fee2e2;
      border: 1px solid #fecaca;
      color: #b91c1c;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
    }
  </style>
{% endblock %}
